#!/bin/bash

export KCLIEDIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )"

if [ -w /etc/bash.bashrc ] ; then
	if ! grep -q "\. ${KCLIEDIR}/etc/profile" /etc/bash.bashrc ; then
		echo ". ${KCLIEDIR}/etc/profile" >> /etc/bash.bashrc
	fi
fi
if [ -w /etc/zsh/zshrc ] ; then
	if ! grep -q "\. ${KCLIEDIR}/etc/profile" /etc/zsh/zshrc ; then
        	echo ". ${KCLIEDIR}/etc/profile" >> /etc/zsh/zshrc
		echo ". ${KCLIEDIR}/etc/zsh/zshrc" >> /etc/zsh/zshrc
		echo ". ${KCLIEDIR}/etc/zsh/zlogout" >> /etc/zsh/zlogout
	fi
fi

# Motd
if [ -w /etc/update-motd.d ] ; then
	mv /etc/update-motd.d /etc/update-motd.d.ubuntu
	mkdir /etc/update-motd.d
	ln -s  ${KCLIEDIR}/bin/kimengumi-banner /etc/update-motd.d/0000-kimengumi 
else
	echo -e "#!/bin/bash\\n${KCLIEDIR}/bin/kimengumi-banner > /etc/motd" > /etc/cron.hourly/kimengumimotd
	chmod 755 /etc/cron.hourly/kimengumimotd
fi

# Ubuntu LightDm config
if [ -d '/usr/share/lightdm/lightdm.conf.d' ] ; then
echo '[SeatDefaults]
greeter-hide-users=true
greeter-show-manual-login=true' > /usr/share/lightdm/lightdm.conf.d/99-kclie.conf
fi
